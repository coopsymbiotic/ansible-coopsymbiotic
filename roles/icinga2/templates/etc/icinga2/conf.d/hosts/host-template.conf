# {{ ansible_managed }}
object Host "{{ inventory_hostname }}" {
  import "{{ icinga2_conf_host_import }}"

  address = "{{ icinga2_node_ipv4_address }}"
{% if icinga2_node_ipv6_address is defined and icinga2_node_ipv6_address != false %}
{% if icinga2_host_ignore_ipv6 is defined and icinga2_host_ignore_ipv6 == true %}
  # Ipv6 monitoring disabled by Ansible host_var (usually because the host does not have a AAAA record)
  # address6 = "{{ icinga2_node_ipv6_address | regex_replace('/\d+$', '') }}"
{% else %}
  address6 = "{{ icinga2_node_ipv6_address | regex_replace('/\d+$', '') }}"
{% endif %}
{% endif %}

  # Generated with:
  # env AEGIR_HOSTMASTER_HOSTNAME='{{ inventory_hostname }}' ansible-playbook -i /etc/ansible/hosts -i ./aegir-inventory -l {{ inventory_hostname }} -t icinga2-conf-host -t never ./site.yml
{% if groups['civicrm_sites'] is defined %}
{% for host in groups['civicrm_sites'] %}
  vars.cms["{{ host }}"] = { cms = "drupal" {% if hostvars[host]['disable_notifications'] is defined %}, disable_notifications=1{% endif %} }
{% endfor %}
{% endif %}
{% if groups['wordpress_sites'] is defined %}
{% for host in groups['wordpress_sites'] %}
  vars.cms["{{ host }}"] = { cms = "wordpress" }
{% endfor %}
{% endif %}
}

{% if preseed_parent is defined %}
object Dependency "child-{{ inventory_hostname }}-parent-{{ preseed_parent }}.symbiotic.coop-host-dependency" {
  child_host_name = "{{ inventory_hostname }}"
  parent_host_name = "{{ preseed_parent }}.symbiotic.coop"
}
{% endif %}
